
# Реализация сервиса отправки данных во внешнее хранилище

## Описание

Данный проект реализует верхнеуровневую архитектуру сервиса для агрегации событий из разных источников и отправки их в различные хранилища данных. Он использует асинхронный подход для обработки событий и метрик с последующей отправкой в Kafka или PostgreSQL. 

## Технологии
- Python 3.9
- aiohttp для асинхронных HTTP запросов
- environs для управления конфигурацией через переменные окружения

## Файлы проекта
- `main.py` - основной скрипт, запускающий сервис.
- `vabus.py` - модуль, имитирующий работу с шиной VaBus.
- `data_sender.py` - модуль для отправки агрегированных данных в Kafka или PostgreSQL.
- `event_aggregator.py` - модуль, выполняющий агрегацию событий.
- `.env` - конфигурационный файл для переменных окружения.
- `Dockerfile` - файл для сборки Docker-контейнера проекта.
- `pyproject.toml` - файл конфигурации для управления зависимостями через инструмент Poetry.

## Установка и запуск

### Через Docker
Для сборки и запуска приложения в контейнере Docker выполните следующие команды:

```bash
docker build -t bus_communication_service .
docker run -it bus_communication_service
```

## Рабочий процесс сервиса

Основная логика сервиса реализована в асинхронной функции `main()`, которая выполняется как бесконечный цикл. На текущем этапе разработки сервис имитирует свою работу через последовательное выполнение следующих шагов:

1. **Получение событий**: В начале каждой итерации цикла сервис имитирует получение нового события от системы VaBus, выводя сообщение `Получение событий`. Реальная логика получения событий заменена на паузу в 1 секунду.

2. **Агрегирование данных**: Полученные события передаются в агрегатор (`EventAggregator`), который накапливает и агрегирует данные в соответствии с определенным временным окном. Выводится сообщение `Агрегирование данных`, имитируя процесс агрегации данных.

3. **Отправка агрегированных данных**: Следующий шаг - имитация отправки агрегированных данных во внешнее хранилище, которое может быть Kafka или PostgreSQL, в зависимости от конфигурации через переменные окружения, сервис выводит сообщение `Отправление агрегированных данных во внешнее хранилище`.

4. **Сбор метрик**: Параллельно с обработкой событий сервис собирает метрики работы приложения с помощью модуля `MetricsCollector`, выводя соответствующее сообщение `Сбор метрик`.

5. **Отправка метрик**: В конце каждой итерации цикла сервис выводит сообщение `Отправление метрик в шину VaBus`, имитируя отправку собранных метрик.

Стоит отметить, что на данный момент в функциях и методах используется заглушка (`pass`), т.е. реальная логика обработки и отправки данных и метрик не реализована. Цель текущей версии - демонстрация предполагаемой структуры и потока данных внутри сервиса.

Между итерациями цикла предусмотрена пауза в 2 секунды для имитации времени обработки и ограничения нагрузки на процессор.

## Возможные проблемы в сервисе
- Проблемы с производительностью при высоком объеме событий: Если сервис начнет получать больше событий, чем он может обработать, это может привести к замедлению работы или даже к отказам.
  
- Ошибки при асинхронной обработке: Асинхронное программирование помогает обрабатывать запросы параллельно, но также увеличивает сложность системы и может приводить к непредвиденным ошибкам, таким как гонки и мертвые блокировки.
  
- Недостаточная отказоустойчивость: В случае сбоев некоторых компонентов сервиса или потери сетевого соединения возможно прерывание работы сервиса.

## Пути решения проблем
- Внедрение очередей и буферизация: Использование систем очередей, таких как Kafka, может помочь в регулировании потока данных и повышении отказоустойчивости.
  
- Мониторинг и автоматическое масштабирование: Реализация систем мониторинга и автоматического масштабирования может помочь в своевременном реагировании на изменения нагрузки.
  
- Повышение отказоустойчивости: Реализация стратегий отказоустойчивости и восстановления после сбоев, таких как репликация данных и автоматическое переключение на резервные системы.

## Потенциальное развитие сервиса
- Интеграция с большим числом хранилищ данных: Расширение функциональности сервиса для работы не только с Kafka и PostgreSQL, но с различными системами хранения данных.
  
- Расширение функциональности аналитики: Добавление дополнительных алгоритмов аналитики и машинного обучения для улучшения агрегации данных и их анализа.


